<UserControl x:Class="Launcher.Controls.ProgressOverlay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Name="root">
    <UserControl.Resources>
        <!-- Bool to Visibility Converter -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        
        <!-- Rotating animation for spinner -->
        <Storyboard x:Key="SpinnerAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="SpinnerRotation"
                           Storyboard.TargetProperty="Angle"
                           From="0"
                           To="360"
                           Duration="0:0:1.5"/>
        </Storyboard>
    </UserControl.Resources>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="Loaded">
            <BeginStoryboard Storyboard="{StaticResource SpinnerAnimation}"/>
        </EventTrigger>
    </UserControl.Triggers>

    <!-- Semi-transparent overlay (non-blocking for dependent dropdowns) -->
    <Grid Background="#40000000" 
          IsHitTestVisible="False"
          Visibility="{Binding ShowOverlay, ElementName=root, Converter={StaticResource BoolToVisibilityConverter}}">
        <!-- Centered progress card -->
        <Border Background="{DynamicResource CardBackgroundBrush}"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="32,24"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                MinWidth="300"
                MaxWidth="400"
                IsHitTestVisible="True">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" 
                                ShadowDepth="0" 
                                Opacity="0.5"
                                Color="Black"/>
            </Border.Effect>
            
            <StackPanel HorizontalAlignment="Center">
                <!-- Animated spinner -->
                <Grid Width="48" Height="48" Margin="0,0,0,16">
                    <Ellipse Stroke="{DynamicResource BodyForegroundBrush}"
                            StrokeThickness="4"
                            StrokeDashArray="12 4"
                            Width="48"
                            Height="48"
                            Opacity="0.7"
                            RenderTransformOrigin="0.5,0.5">
                        <Ellipse.RenderTransform>
                            <RotateTransform x:Name="SpinnerRotation" Angle="0"/>
                        </Ellipse.RenderTransform>
                    </Ellipse>
                </Grid>
                
                <!-- Progress message -->
                <TextBlock Text="{Binding Message, ElementName=root}"
                          FontSize="14"
                          Foreground="{DynamicResource BodyForegroundBrush}"
                          TextAlignment="Center"
                          TextWrapping="Wrap"
                          MaxWidth="300"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
